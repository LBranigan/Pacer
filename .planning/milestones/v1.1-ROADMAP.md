# Milestone v1.1: ASR Ensemble

**Status:** SHIPPED 2026-02-04
**Phases:** 10-17
**Total Plans:** 22

## Overview

Improve ASR accuracy and reliability using a two-model ensemble (`latest_long` + `default`) with VAD-based hallucination detection, separate disfluency classification, and safety checks.

## Phases

### Phase 10: Configuration
**Goal**: Tune speech boosting parameters for ensemble-ready ASR
**Depends on**: Phase 9 (v1.0 complete)
**Requirements**: CFG-01, CFG-02, CFG-03
**Plans**: 1 plan

Plans:
- [x] 10-01-PLAN.md — Tiered speech context boosting

**Details:**
- `latest_long` boost level reduced from 5 to 3
- Tiered boosting: proper nouns (5), uncommon words (3), common words (0)
- `default` model configuration with lower boost values (3, 2)

### Phase 11: Ensemble Core
**Goal**: Run two STT models in parallel with temporal word association
**Depends on**: Phase 10
**Requirements**: ENS-01, ENS-02, ENS-03, ENS-04
**Plans**: 3 plans (2 waves)

Plans:
- [x] 11-01-PLAN.md — Parallel model API calls (Wave 1)
- [x] 11-02-PLAN.md — Temporal word association algorithm (Wave 1)
- [x] 11-03-PLAN.md — Transcript merger with app.js integration (Wave 2)

**Details:**
- Both `latest_long` and `default` models called in parallel
- Words associated by time overlap (50ms jitter tolerance)
- Merged transcript includes `_debug` property showing both model results
- Words tagged with source: `both`, `latest_only`, or `default_only`

### Phase 12: VAD Integration
**Goal**: Detect hallucinations by checking for actual speech during `latest_only` words
**Depends on**: Phase 11
**Requirements**: VAD-01, VAD-02, VAD-03, VAD-04, VAD-05, VAD-06, VAD-07
**Plans**: 4 plans (3 waves)

Plans:
- [x] 12-01-PLAN.md — ONNX runtime + Silero VAD setup (Wave 1)
- [x] 12-02-PLAN.md — Ghost detection logic (Wave 2)
- [x] 12-03-PLAN.md — App integration with VAD flow (Wave 3)
- [x] 12-04-PLAN.md — Calibration system + Settings UI (Wave 2)

**Details:**
- Silero VAD runs in browser via ONNX runtime
- VAD processes completed audio file (post-record, Chromebook-safe)
- Ghost detection for `latest_only + IN REFERENCE` words with no speech overlap
- 2-second calibration with noise-based threshold (0.15-0.60)

### Phase 13: Confidence Classification
**Goal**: Apply asymmetric trust policy based on reference presence and model agreement
**Depends on**: Phase 12
**Requirements**: CONF-01, CONF-02, CONF-03, CONF-04
**Plans**: 3 plans (3 waves)

Plans:
- [x] 13-01-PLAN.md — Word equivalences extension + confidence config (Wave 1)
- [x] 13-02-PLAN.md — Confidence classifier core (Wave 2)
- [x] 13-03-PLAN.md — App integration with classification flow (Wave 3)

**Details:**
- `latest_only` words in reference trusted (stronger model caught quiet speech)
- `latest_only` words NOT in reference distrusted (hallucination risk)
- Research-backed thresholds: 0.93 (high), 0.70 (low)
- Ghost words filtered before alignment

### Phase 14: Disfluency Detection
**Goal**: Detect stutters and reading disfluencies as a separate signal from confidence
**Depends on**: Phase 13
**Requirements**: DIS-01, DIS-02, DIS-03, DIS-04, DIS-05
**Plans**: 3 plans (3 waves)

Plans:
- [x] 14-01-PLAN.md — Stutter metrics calculation (Wave 1)
- [x] 14-02-PLAN.md — Disfluency severity classification (Wave 2)
- [x] 14-03-PLAN.md — Fragment merger and app integration (Wave 3)

**Details:**
- Stutter metrics: attempt count, total duration, max pause
- Severity: none | minor | moderate | significant
- Significant = maxPause >= 0.5s OR totalDuration >= 2.0s
- Fragment merging for orphaned stutter attempts

### Phase 15: Safety Checks
**Goal**: Flag physically impossible or suspicious ASR outputs
**Depends on**: Phase 14
**Requirements**: SAFE-01, SAFE-02, SAFE-03, SAFE-04
**Plans**: 3 plans (3 waves)

Plans:
- [x] 15-01-PLAN.md — Safety config + rate anomaly detection (Wave 1)
- [x] 15-02-PLAN.md — Uncorroborated sequence detection + flag resolution (Wave 2)
- [x] 15-03-PLAN.md — App integration with safety check flow (Wave 3)

**Details:**
- Rate anomaly detection (>5 words/second = physically impossible)
- Uncorroborated sequence flagging (7+ in-ref, 3+ not-in-ref)
- Strong corroboration override (0.93 threshold)
- Collapse detection (>40% flagged)

### Phase 16: UI Enhancements
**Goal**: Surface ensemble data, disfluency badges, and calibration controls in the UI
**Depends on**: Phase 15
**Requirements**: UI-01, UI-02, UI-03, UI-04, UI-05, UI-06, CFG-04
**Plans**: 4 plans (2 waves)

Plans:
- [x] 16-01-PLAN.md — Word tooltip enhancements with ensemble data and rate anomaly underline
- [x] 16-02-PLAN.md — Disfluency severity badges with attempt trace tooltips
- [x] 16-03-PLAN.md — WCPM range display with fluency concerns summary
- [x] 16-04-PLAN.md — VAD calibration UI restructure with dev mode gating

**Details:**
- Word hover tooltip shows both model results
- Disfluency badges (dot, double-dot, warning icon)
- WCPM displays as range (e.g., 85-92)
- Fluency concerns summary with severity counts
- VAD calibration UI with dev mode slider

### Phase 17: Integration Bug Fixes (INSERTED)
**Goal**: Fix critical wiring bugs preventing tooltip and WCPM range from working correctly
**Depends on**: Phase 16
**Plans**: 1 plan

Plans:
- [x] 17-01-PLAN.md — Fix tooltip property mismatch and severity propagation

**Details:**
- Fixed `_debug.latest` → `_debug.latestLong` property reference
- Added severity propagation to alignment items for WCPM range

---

## Milestone Summary

**Decimal Phases:**
- Phase 17: Integration Bug Fixes (inserted after Phase 16 for gap closure)

**Key Decisions:**
- Temporal word association over text-based alignment (stutters break text matching)
- Silero VAD for hallucination detection (not universal filter)
- Separate disfluency signal from confidence (clinical nuance)
- `default` model as ensemble partner (Whisper has 40% hallucination rate)
- Post-process VAD (Chromebook-safe, no CPU spike during recording)
- Ghost words filtered before alignment (prevents WCPM inflation)
- Conservative WCPM (min value) as primary display

**Issues Resolved:**
- Unreliable `latest_long` confidence scores — ensemble provides corroboration
- Hallucinated words in reference text — VAD ghost detection catches them
- Confidence conflated with fluency — separate disfluency layer
- No visibility into model disagreement — tooltips show both results
- WCPM falsely inflated by hallucinations — ghost filtering + range display

**Issues Deferred:**
- Ensemble for async path (>60s recordings) — not implemented yet
- Full prosody scoring from waveform — deferred to v1.2+

**Technical Debt Incurred:**
- None — Phase 17 closed all integration gaps

---

*For current project status, see .planning/ROADMAP.md*
