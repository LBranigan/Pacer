# Codebase Structure

**Analysis Date:** 2026-02-02

## Directory Layout

```
googstt/
├── .planning/
│   └── codebase/           # Analysis documentation (generated)
├── orf_assessment.html     # Single-file web application
├── PLAN.md                 # Project roadmap and status
├── SETTINGS.md             # Google Cloud STT configuration reference
└── orf_assessment.html     # The complete application
```

## Directory Purposes

**.planning/codebase/:**
- Purpose: Houses codebase analysis documents generated by the GSD mapping system
- Contains: ARCHITECTURE.md, STRUCTURE.md, CONVENTIONS.md, TESTING.md, CONCERNS.md (generated on-demand)
- Key files: None (generated)
- Notes: Directory exists but is not source code; used for reference during development planning

## Key File Locations

**Entry Points:**
- `orf_assessment.html`: Complete application entry point. Open in any web browser (double-click or drag to browser). No server required.

**Configuration:**
- No separate configuration files. All settings embedded in `orf_assessment.html`
- STT settings documented in `SETTINGS.md` (reference only, not code)
- API endpoint: Hardcoded to `https://speech.googleapis.com/v1/speech:recognize` (line 164)

**Core Logic:**
- Audio recording: `startRecording()` (lines 83-108), `stopRecording()` (lines 110-117)
- File upload: `handleFile()` (lines 119-127)
- STT integration: `sendToSTT()` (lines 129-174)
- Results rendering: `displayResults()` (lines 184-232)
- Utilities: `blobToBase64()` (lines 176-182), `setStatus()` (line 77), `toggleRecord()` (lines 79-81)

**Testing:**
- Not applicable. No test files. See PLAN.md Phase 1 (Phase 1: API Robustness) for planned testing approach.

## Naming Conventions

**Files:**
- `.html`: Web application file (single monolithic file)
- `.md`: Markdown documentation (PLAN.md, SETTINGS.md, analysis docs)
- Convention: Descriptive names (orf_assessment.html = Oral Reading Fluency Assessment)

**Directories:**
- Lowercase with underscores: `.planning/` (hidden config directory)
- Convention: Prefixed dot for private/tool directories

**Functions:**
- camelCase: `toggleRecord()`, `startRecording()`, `stopRecording()`, `handleFile()`, `sendToSTT()`, `blobToBase64()`, `setStatus()`, `displayResults()`
- Pattern: Verb-first naming describing action (toggle, start, stop, handle, send, blob-to, set, display)
- Scope: All global scope (no namespace/module system in single-file app)

**Variables:**
- camelCase: `mediaRecorder`, `audioChunks`, `recording`, `timerInterval`, `seconds`, `apiKey`, `passageText`, `speechContexts`, `allWords`, `plainParts`
- Pattern: Descriptive names matching purpose
- Scope: Mix of global (mediaRecorder, audioChunks, recording, timerInterval, seconds) and local (apiKey, passageText, etc.)

**CSS Classes:**
- lowercase with dash-separators: `.result-box`, `.legend`, `.word.high`, `.word.mid`, `.word.low`
- Pattern: Functional class names (high/mid/low confidence states)
- Applied to: Result display elements, confidence coloring

**HTML IDs:**
- camelCase: `#apiKey`, `#transcript`, `#recordBtn`, `#timer`, `#fileInput`, `#status`, `#resultWords`, `#resultPlain`, `#resultJson`, `#uploadBtn`
- Pattern: Descriptive, corresponding to form fields and output areas
- Used by: JavaScript DOM manipulation (getElementById)

## Where to Add New Code

**New Feature (e.g., Audio Playback):**
- Primary code: Add function at end of `<script>` block in `orf_assessment.html` (after line 232)
- HTML markup: Add new `<div>` or `<button>` in appropriate `.section` (before closing body tag, line 72)
- CSS: Add new styles in `<style>` block (before closing `</style>`, line 31)
- Pattern: Follow existing camelCase function naming and class naming conventions
- Example: To add playback button, add `<button id="playBtn" onclick="playAudio()">` in audio section + write `playAudio()` function + add CSS for button styling

**New Component/Module:**
- **Current limitation:** Monolithic single-file architecture. No modular structure.
- **Recommendation for future:** If splitting into multiple files, follow pattern:
  - `orf-audio.js`: Audio recording, file upload, encoding logic
  - `orf-stt.js`: STT API integration, request/response handling
  - `orf-display.js`: Results rendering and UI updates
  - `orf-ui.js`: Event handlers, status updates
  - Keep HTML minimal, load scripts via `<script src="..."></script>`

**Utilities:**
- Shared helpers: Add to bottom of `<script>` block before closing tag
- Pattern: Keep utilities pure (no side effects), camelCase naming
- Current example: `blobToBase64()` (lines 176-182) is a pure utility function

## Special Directories

**.planning/:**
- Purpose: GSD (Google Speech Development?) system analysis output
- Generated: Yes (created by mapping tools)
- Committed: Not source code, for reference only
- Contents: ARCHITECTURE.md, STRUCTURE.md, CONVENTIONS.md, TESTING.md, CONCERNS.md

## Notes on Current Architecture

**Why single-file monolithic design:**
- Entry requirement: "double-click to open in any browser, no server needed"
- Simplicity: No build step, no npm/bundler, no deployment complexity
- Portability: Self-contained, works offline after API key is provided

**Constraints for adding new code:**
- 236 lines total (HTML + CSS + JavaScript combined)
- Global scope pollution risk as features grow
- No module system or namespace management
- All DOM elements must have unique IDs

**Growth path (per PLAN.md):**
- Phase 2: Implement diff/alignment algorithm (add 200+ lines, consider refactoring to modular)
- Phase 3: Add scoring metrics (word-level calculations, could become utility module)
- Phase 4: Add reporting UI (likely exceeds single-file practical limit)
- Recommendation: Refactor to multi-file structure before Phase 2 implementation

---

*Structure analysis: 2026-02-02*
