---
phase: 24-disfluency-ui-display
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - js/miscue-registry.js
  - style.css
  - index.html
autonomous: true

must_haves:
  truths:
    - "miscue-registry.js contains reverb_filler, reverb_repetition, reverb_false_start entries"
    - "Each new entry has countsAsError: false"
    - "CSS class .word-disfluency exists with ::before pseudo-element dot marker"
    - "HTML contains collapsible disfluency section matching Confidence View pattern"
  artifacts:
    - path: "js/miscue-registry.js"
      provides: "Reverb disfluency type definitions"
      contains: "reverb_filler"
    - path: "style.css"
      provides: "Disfluency dot marker and collapsible section styles"
      contains: ".word-disfluency"
    - path: "index.html"
      provides: "Disfluency diagnostics section HTML"
      contains: "disfluencySection"
  key_links:
    - from: "style.css"
      to: "index.html"
      via: "CSS class on #disfluencySection"
      pattern: "\\.disfluency-section"
---

<objective>
Add the foundation artifacts for Phase 24 disfluency UI: miscue registry entries, CSS styles, and HTML structure.

Purpose: Establishes the styling and structural foundation that Plan 02 will wire up with JavaScript logic. Separating foundation from logic keeps each plan focused and under context budget.

Output: Updated miscue-registry.js with 3 new disfluency types, CSS styles for dot marker and collapsible section, HTML section for disfluency diagnostics.
</objective>

<execution_context>
@/home/brani/.claude/get-shit-done/workflows/execute-plan.md
@/home/brani/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/24-disfluency-ui-display/24-CONTEXT.md
@.planning/phases/24-disfluency-ui-display/24-RESEARCH.md
@js/miscue-registry.js
@style.css
@index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add reverb disfluency types to miscue-registry.js</name>
  <files>js/miscue-registry.js</files>
  <action>
Add a new section `REVERB_DISFLUENCY_MISCUES` between DISFLUENCY_MISCUES and DIAGNOSTIC_MISCUES (around line 109). This section contains three entries for the Kitchen Sink pipeline's model-level disfluency detection from Phase 23:

```javascript
// ============================================================================
// REVERB DISFLUENCY MISCUES (detected in disfluency-tagger.js via Kitchen Sink pipeline)
// Model-level disfluencies from Reverb verbatim vs clean diff (Phase 23/24)
// ============================================================================

const REVERB_DISFLUENCY_MISCUES = {
  reverb_filler: {
    description: 'Filler word detected by Reverb verbatim/clean diff (um, uh, er, ah, mm, hmm)',
    detector: 'disfluency-tagger.js -> tagDisfluencies() via kitchen-sink-merger.js',
    countsAsError: false,
    config: null,
    example: {
      reference: 'the cat sat',
      spoken: 'the um cat sat',
      result: '"um" detected as filler via Reverb v=1.0 vs v=0.0 alignment'
    },
    uiClass: 'word-disfluency',
    note: 'Model-level detection: Reverb includes fillers in verbatim (v=1.0) but removes them in clean (v=0.0). Needleman-Wunsch alignment identifies the insertion.'
  },

  reverb_repetition: {
    description: 'Word repetition detected by Reverb verbatim/clean diff',
    detector: 'disfluency-tagger.js -> tagDisfluencies() via kitchen-sink-merger.js',
    countsAsError: false,
    config: null,
    example: {
      reference: 'the cat sat',
      spoken: 'the the cat sat',
      result: '"the" (first) detected as repetition via Reverb v=1.0 vs v=0.0 alignment'
    },
    uiClass: 'word-disfluency',
    note: 'Model-level detection: Reverb preserves repetitions in verbatim but normalizes them in clean output.'
  },

  reverb_false_start: {
    description: 'False start (partial word) detected by Reverb verbatim/clean diff',
    detector: 'disfluency-tagger.js -> tagDisfluencies() via kitchen-sink-merger.js',
    countsAsError: false,
    config: null,
    example: {
      reference: 'the cat sat',
      spoken: 'the ca- cat sat',
      result: '"ca-" detected as false start via Reverb v=1.0 vs v=0.0 alignment'
    },
    uiClass: 'word-disfluency',
    note: 'Model-level detection: Reverb captures partial word attempts in verbatim that are absent from clean output.'
  }
};
```

Then add `...REVERB_DISFLUENCY_MISCUES,` to the MISCUE_REGISTRY export object (after `...DISFLUENCY_MISCUES,`).

Update the QUICK REFERENCE comment at the bottom to add these three under "NOT ERRORS (diagnostic only)":
```
 * - reverb_filler: Filler word (um, uh) via Reverb model diff
 * - reverb_repetition: Word repetition via Reverb model diff
 * - reverb_false_start: False start via Reverb model diff
```
  </action>
  <verify>
Open js/miscue-registry.js and confirm:
1. `REVERB_DISFLUENCY_MISCUES` object exists with `reverb_filler`, `reverb_repetition`, `reverb_false_start`
2. All three have `countsAsError: false`
3. All three have `uiClass: 'word-disfluency'`
4. The MISCUE_REGISTRY spread includes `...REVERB_DISFLUENCY_MISCUES`
5. Quick reference comment updated
  </verify>
  <done>miscue-registry.js contains reverb_filler, reverb_repetition, reverb_false_start entries, all with countsAsError: false and uiClass: 'word-disfluency'</done>
</task>

<task type="auto">
  <name>Task 2: Add CSS styles and HTML structure for disfluency UI</name>
  <files>style.css, index.html</files>
  <action>
**CSS (style.css):** Add styles after the existing confidence section styles (around line 338). Follow the exact Confidence View pattern for the collapsible section.

```css
/* ───────────────────────────────────────────────────────────────────────────
   Disfluency dot marker (Phase 24)
   Small dot above disfluent words via ::before pseudo-element
   ─────────────────────────────────────────────────────────────────────────── */
.word-disfluency {
  position: relative;
}

.word-disfluency::before {
  content: '\2022';
  position: absolute;
  top: -8px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 0.5rem;
  color: #9e9e9e;
  line-height: 1;
  pointer-events: none;
}

/* ───────────────────────────────────────────────────────────────────────────
   Disfluency diagnostics section (Phase 24) - collapsible
   Clones Confidence View pattern from .confidence-section
   ─────────────────────────────────────────────────────────────────────────── */
.disfluency-section {
  margin-top: 1rem;
  border: 1px solid #ddd;
  border-radius: 6px;
  overflow: hidden;
}

.disfluency-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.5rem 0.75rem;
  background: #f5f5f5;
  cursor: pointer;
  user-select: none;
}

.disfluency-header:hover {
  background: #eee;
}

.disfluency-header h4 {
  font-size: 0.9rem;
  font-weight: 600;
  color: #555;
  margin: 0;
}

.disfluency-toggle {
  font-size: 0.8rem;
  color: #888;
  transition: transform 0.2s;
}

.disfluency-section.expanded .disfluency-toggle {
  transform: rotate(180deg);
}

.disfluency-body {
  display: none;
  padding: 0.75rem;
  background: #fafafa;
}

.disfluency-section.expanded .disfluency-body {
  display: block;
}

.disfluency-summary {
  font-size: 0.85rem;
  color: #666;
  margin-bottom: 0.5rem;
}

.disfluency-details {
  font-size: 0.85rem;
  color: #555;
  line-height: 1.8;
}

.disfluency-details .disfluency-type-row {
  display: flex;
  justify-content: space-between;
  padding: 0.15rem 0;
}

.disfluency-details .disfluency-type-label {
  color: #555;
}

.disfluency-details .disfluency-type-count {
  font-weight: 600;
  color: #333;
}
```

**HTML (index.html):** Add the disfluency section AFTER the Confidence View section (`</div>` closing `confidenceSection`, around line 138) and BEFORE the Metrics label (line 140). Place it between the confidence section closing and the metrics label.

```html
  <!-- Disfluency Diagnostics (Phase 24) - collapsed by default -->
  <div class="disfluency-section" id="disfluencySection" style="display:none;">
    <div class="disfluency-header" onclick="document.getElementById('disfluencySection').classList.toggle('expanded')">
      <h4>Disfluencies</h4>
      <span class="disfluency-toggle">&#9660;</span>
    </div>
    <div class="disfluency-body">
      <div class="disfluency-summary" id="disfluencySummaryText"></div>
      <div class="disfluency-details" id="disfluencyDetails"></div>
    </div>
  </div>
```

The section starts with `style="display:none"` so it only appears when JavaScript populates it with data (Plan 02 handles this). This avoids showing an empty section when no disfluency data exists (Pitfall 2 from research).

Also ensure sufficient line-height / padding on the word rendering area (`#resultWords` or `.result-box`) so that the `::before` dot at `top: -8px` doesn't clip. Check existing `.result-box` styles -- if `line-height` is less than 2, increase to 2 or add `padding-top: 0.5rem` to `.result-box` to accommodate dots.
  </action>
  <verify>
1. Open style.css and search for `.word-disfluency` -- confirm ::before pseudo-element with bullet dot
2. Open style.css and search for `.disfluency-section` -- confirm full collapsible pattern matching Confidence View
3. Open index.html and search for `disfluencySection` -- confirm HTML structure with header, body, summary, details divs
4. Confirm disfluency section is between confidence section and metrics label
5. Confirm `style="display:none"` on the disfluency section div
  </verify>
  <done>CSS has .word-disfluency with dot marker and .disfluency-section collapsible styles. HTML has disfluencySection with header toggle, summary, and details areas. Section hidden by default.</done>
</task>

</tasks>

<verification>
1. `grep -n 'reverb_filler' js/miscue-registry.js` returns line with entry
2. `grep -n 'word-disfluency' style.css` returns CSS rule
3. `grep -n 'disfluencySection' index.html` returns HTML element
4. All three reverb disfluency entries have `countsAsError: false`
5. HTML section has `style="display:none"` (hidden until data available)
</verification>

<success_criteria>
- miscue-registry.js has reverb_filler, reverb_repetition, reverb_false_start (all countsAsError: false)
- style.css has .word-disfluency::before dot marker and .disfluency-section collapsible pattern
- index.html has disfluencySection element with header toggle, summary text area, and details area
- Disfluency section is hidden by default and positioned between Confidence View and Metrics
</success_criteria>

<output>
After completion, create `.planning/phases/24-disfluency-ui-display/24-01-SUMMARY.md`
</output>
