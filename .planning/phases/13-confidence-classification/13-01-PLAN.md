---
phase: 13-confidence-classification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - js/word-equivalences.js
  - js/confidence-config.js
autonomous: true

must_haves:
  truths:
    - "Homophones match for reference lookup (their/there/they're treated as equivalent)"
    - "Numbers 1-100 match word forms (21 matches twenty-one)"
    - "Ordinals match (1st matches first, 2nd matches second)"
    - "Confidence thresholds are configurable via single source of truth"
  artifacts:
    - path: "js/word-equivalences.js"
      provides: "Extended equivalence groups with homophones and numbers"
      contains: "HOMOPHONE_GROUPS"
    - path: "js/confidence-config.js"
      provides: "Threshold constants for confidence classification"
      exports: ["CONFIDENCE_THRESHOLDS"]
  key_links:
    - from: "js/word-equivalences.js"
      to: "EQUIVALENCE_GROUPS"
      via: "Array concatenation"
      pattern: "HOMOPHONE_GROUPS|NUMBER_WORDS"
---

<objective>
Extend word equivalences with homophones and full number coverage, and create confidence threshold configuration.

Purpose: Reference matching must recognize homophones (their/there/they're) and numbers (21/twenty-one) as equivalent. Thresholds must be developer-tunable via config file.
Output: Extended word-equivalences.js and new confidence-config.js
</objective>

<execution_context>
@/home/brani/.claude/get-shit-done/workflows/execute-plan.md
@/home/brani/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/13-confidence-classification/13-CONTEXT.md
@.planning/phases/13-confidence-classification/13-RESEARCH.md

@js/word-equivalences.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend word-equivalences.js with homophones and numbers</name>
  <files>js/word-equivalences.js</files>
  <action>
Add HOMOPHONE_GROUPS array after existing EQUIVALENCE_GROUPS:

```javascript
const HOMOPHONE_GROUPS = [
  ['their', 'there', "they're"],
  ['your', "you're"],
  ['its', "it's"],
  ['to', 'too', 'two'],
  ['by', 'bye', 'buy'],
  ['for', 'four', 'fore'],
  ['no', 'know'],
  ['new', 'knew', 'gnu'],
  ['right', 'write', 'rite'],
  ['see', 'sea'],
  ['be', 'bee'],
  ['hear', 'here'],
  ['our', 'hour'],
  ['ate', 'eight'],
  ['one', 'won'],
  ['sun', 'son'],
  ['would', 'wood'],
  ['which', 'witch'],
  ['wear', 'where', 'ware'],
  ['weather', 'whether'],
  ['piece', 'peace'],
  ['break', 'brake'],
  ['wait', 'weight'],
  ['great', 'grate'],
  ['whole', 'hole'],
  ['pair', 'pear', 'pare'],
  ['meet', 'meat'],
  ['read', 'red'],  // Past tense of read
  ['led', 'lead'],  // Metal
  ['bored', 'board'],
  ['flower', 'flour'],
  ['role', 'roll'],
  ['through', 'threw'],
  ['principal', 'principle'],
  ['stationary', 'stationery'],
  ['council', 'counsel'],
];
```

Add NUMBER_WORDS array for 21-100 and ordinals:

```javascript
const NUMBER_WORDS = [
  // 21-29
  ['21', 'twenty-one', 'twentyone'],
  ['22', 'twenty-two', 'twentytwo'],
  ['23', 'twenty-three', 'twentythree'],
  ['24', 'twenty-four', 'twentyfour'],
  ['25', 'twenty-five', 'twentyfive'],
  ['26', 'twenty-six', 'twentysix'],
  ['27', 'twenty-seven', 'twentyseven'],
  ['28', 'twenty-eight', 'twentyeight'],
  ['29', 'twenty-nine', 'twentynine'],
  // Tens
  ['30', 'thirty'],
  ['40', 'forty'],
  ['50', 'fifty'],
  ['60', 'sixty'],
  ['70', 'seventy'],
  ['80', 'eighty'],
  ['90', 'ninety'],
  ['100', 'hundred', 'one hundred'],
  // Ordinals 1-20
  ['1st', 'first'],
  ['2nd', 'second'],
  ['3rd', 'third'],
  ['4th', 'fourth'],
  ['5th', 'fifth'],
  ['6th', 'sixth'],
  ['7th', 'seventh'],
  ['8th', 'eighth'],
  ['9th', 'ninth'],
  ['10th', 'tenth'],
  ['11th', 'eleventh'],
  ['12th', 'twelfth'],
  ['13th', 'thirteenth'],
  ['14th', 'fourteenth'],
  ['15th', 'fifteenth'],
  ['16th', 'sixteenth'],
  ['17th', 'seventeenth'],
  ['18th', 'eighteenth'],
  ['19th', 'nineteenth'],
  ['20th', 'twentieth'],
];
```

Modify the canonical map builder to include all groups:

```javascript
const ALL_EQUIVALENCE_GROUPS = [
  ...EQUIVALENCE_GROUPS,
  ...HOMOPHONE_GROUPS,
  ...NUMBER_WORDS,
];

const wordToCanonical = new Map();
for (const group of ALL_EQUIVALENCE_GROUPS) {
  const canonical = group[0];
  for (const word of group) {
    if (!wordToCanonical.has(word)) {
      wordToCanonical.set(word, canonical);
    }
  }
}
```

Export a new function for confidence classifier to get all equivalents:

```javascript
/**
 * Get all equivalent forms for a word (for building reference set).
 * Returns array including the word itself.
 * @param {string} word - Normalized word
 * @returns {string[]} All equivalent forms
 */
export function getAllEquivalents(word) {
  for (const group of ALL_EQUIVALENCE_GROUPS) {
    if (group.includes(word)) {
      return [...group];
    }
  }
  return [word];
}
```
  </action>
  <verify>
Manual test in browser console after loading app:
```javascript
import { getCanonical, getAllEquivalents } from './js/word-equivalences.js';
// Homophones
console.assert(getCanonical('there') === 'their', 'Homophone: there->their');
console.assert(getCanonical("they're") === 'their', "Homophone: they're->their");
// Numbers
console.assert(getCanonical('twenty-one') === '21', 'Number: twenty-one->21');
console.assert(getCanonical('first') === '1st', 'Ordinal: first->1st');
// getAllEquivalents
console.assert(getAllEquivalents('their').includes('there'), 'getAllEquivalents includes there');
console.log('word-equivalences tests passed');
```
  </verify>
  <done>
- HOMOPHONE_GROUPS array exists with 35+ common homophone sets
- NUMBER_WORDS array exists with 21-100 and ordinals 1-20
- getCanonical() works for homophones and numbers
- getAllEquivalents() exported and functional
  </done>
</task>

<task type="auto">
  <name>Task 2: Create confidence-config.js with thresholds</name>
  <files>js/confidence-config.js</files>
  <action>
Create new file js/confidence-config.js:

```javascript
/**
 * Confidence classification thresholds and constants.
 * Developer-tunable values for asymmetric trust policy.
 *
 * Per CONTEXT.md:
 * - Thresholds are INCLUSIVE (0.70 exactly = Medium, not Low)
 * - Values are research-backed: 0.93 (high), 0.70 (low)
 */

export const CONFIDENCE_THRESHOLDS = Object.freeze({
  // Trust level boundaries (inclusive)
  HIGH: 0.93,      // >= 0.93 = High confidence (crystal clear)
  MEDIUM: 0.70,    // >= 0.70 = Medium confidence (acceptable)
  // Below 0.70 = Low confidence (uncertain)
  // 0.0 = Ghost (VAD detected no speech)

  // Assigned confidence for special cases
  VALID_MUMBLE: 0.85,        // latest_only + IN reference (benefit of doubt)
  HALLUCINATION_RISK: 0.50,  // latest_only + NOT in reference (below MEDIUM)
});

/**
 * Trust level enum for type safety.
 */
export const TRUST_LEVELS = Object.freeze({
  HIGH: 'high',
  MEDIUM: 'medium',
  LOW: 'low',
  GHOST: 'ghost',
});

/**
 * Flag constants for _flags array.
 */
export const CONFIDENCE_FLAGS = Object.freeze({
  POSSIBLE_INSERTION: 'possible_insertion',
  VAD_GHOST: 'vad_ghost',
  DEFAULT_ONLY_NOT_IN_REF: 'default_only_not_in_ref',
});
```
  </action>
  <verify>
Check file exists and exports are valid:
```bash
# File exists
ls -la js/confidence-config.js

# Quick syntax check via Node (if available) or browser import
```

Browser console test:
```javascript
import { CONFIDENCE_THRESHOLDS, TRUST_LEVELS } from './js/confidence-config.js';
console.assert(CONFIDENCE_THRESHOLDS.HIGH === 0.93, 'HIGH threshold');
console.assert(CONFIDENCE_THRESHOLDS.MEDIUM === 0.70, 'MEDIUM threshold');
console.assert(TRUST_LEVELS.GHOST === 'ghost', 'GHOST level');
console.log('confidence-config tests passed');
```
  </verify>
  <done>
- js/confidence-config.js exists
- CONFIDENCE_THRESHOLDS exported with HIGH=0.93, MEDIUM=0.70, VALID_MUMBLE=0.85, HALLUCINATION_RISK=0.50
- TRUST_LEVELS exported with high/medium/low/ghost
- CONFIDENCE_FLAGS exported with possible_insertion, vad_ghost
- All exports are Object.freeze() for immutability
  </done>
</task>

</tasks>

<verification>
1. word-equivalences.js loads without errors in browser
2. confidence-config.js loads without errors in browser
3. Existing app functionality unaffected (no breaking changes)
4. getCanonical('there') returns 'their'
5. getCanonical('twenty-one') returns '21'
6. getAllEquivalents('their') returns array with their/there/they're
</verification>

<success_criteria>
- Homophones are recognized as equivalent for reference matching
- Numbers 21-100 and ordinals 1st-20th are recognized
- Confidence thresholds are defined in single source of truth
- No breaking changes to existing word-equivalences.js consumers
</success_criteria>

<output>
After completion, create `.planning/phases/13-confidence-classification/13-01-SUMMARY.md`
</output>
