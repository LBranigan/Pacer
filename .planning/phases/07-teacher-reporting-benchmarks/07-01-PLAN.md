---
phase: 07-teacher-reporting-benchmarks
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - js/benchmarks.js
  - js/storage.js
  - index.html
  - sw.js
autonomous: true

must_haves:
  truths:
    - "Hasbrouck-Tindal 2017 norms for grades 1-6 are available as importable functions"
    - "Season detection from date works (Fall=Aug-Nov, Winter=Dec-Feb, Spring=Mar-Jul)"
    - "Student profile supports optional grade field"
    - "Existing students without grade get null (no data loss)"
    - "Teacher can set grade when creating a new student"
  artifacts:
    - path: "js/benchmarks.js"
      provides: "HT norms data, getBenchmarkStatus(), getSeason()"
      exports: ["HT_NORMS", "getBenchmarkStatus", "getSeason"]
    - path: "js/storage.js"
      provides: "v3 migration adding grade to students"
      contains: "version: 3"
  key_links:
    - from: "js/storage.js"
      to: "js/benchmarks.js"
      via: "grade field enables benchmark lookup"
      pattern: "grade"
---

<objective>
Create the Hasbrouck-Tindal benchmarks module and add grade field to student profiles via storage migration.

Purpose: Foundation for benchmark comparison and RTI reporting — both require knowing the student's grade and having norms data available.
Output: js/benchmarks.js module, updated storage.js with v2->v3 migration, grade field in student creation UI.
</objective>

<execution_context>
@/home/brani/.claude/get-shit-done/workflows/execute-plan.md
@/home/brani/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-teacher-reporting-benchmarks/07-RESEARCH.md
@js/storage.js
@index.html
@sw.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create benchmarks module and migrate storage to v3</name>
  <files>js/benchmarks.js, js/storage.js</files>
  <action>
Create `js/benchmarks.js` as an ES module exporting:

1. `HT_NORMS` — object keyed by grade (1-6), then season (fall/winter/spring), each containing `{ p10, p25, p50, p75, p90 }` WCPM values. Use the exact values from 07-RESEARCH.md (note: grade 1 has no fall norms — only winter and spring). These are from training data and flagged for manual verification later.

2. `getSeason(date)` — takes a date string/Date, returns 'fall' (Aug-Nov, months 7-10), 'winter' (Dec-Feb, months 11,0,1), or 'spring' (Mar-Jul, months 2-6). Uses 0-indexed `getMonth()`.

3. `getBenchmarkStatus(wcpm, grade, season)` — looks up norms, returns `{ status, label, color, norms }`:
   - wcpm >= p50: `{ status: 'on-track', label: 'On Track', color: '#2e7d32', norms }`
   - wcpm >= p25: `{ status: 'some-risk', label: 'Some Risk', color: '#f57f17', norms }`
   - wcpm < p25: `{ status: 'at-risk', label: 'At Risk', color: '#c62828', norms }`
   - No norms found: `{ status: 'unknown', label: 'No norms available', color: '#757575', norms: null }`

Then update `js/storage.js`:
- In `migrate()`, add v2->v3 step: iterate `data.students`, set `s.grade = s.grade || null` for each. Set `data.version = 3`.
- Update `defaultData()` to return `version: 3`.
- Add exported function `updateStudentGrade(studentId, grade)` — loads data, finds student by id, sets grade (integer 1-6 or null), saves.
  </action>
  <verify>Open browser console, confirm: `import { HT_NORMS, getBenchmarkStatus, getSeason } from './js/benchmarks.js'` works. Confirm `getBenchmarkStatus(100, 3, 'fall')` returns on-track. Confirm storage loads without error and existing students get `grade: null`.</verify>
  <done>benchmarks.js exports all three functions with correct norms data. storage.js migrates to v3 with grade field. updateStudentGrade function available.</done>
</task>

<task type="auto">
  <name>Task 2: Add grade field to student creation and update service worker</name>
  <files>index.html, sw.js</files>
  <action>
In `index.html`, find the student creation form/dialog. Add a grade `<select>` dropdown next to the student name input:
- Options: "Grade (optional)" as default/empty, then "Grade 1" through "Grade 6" with values 1-6.
- When creating a student, pass the selected grade value (or null if empty) to the `addStudent()` call. Check how `addStudent` is called and update it to accept grade.

In `js/storage.js`, update `addStudent(name)` signature to `addStudent(name, grade = null)` and include `grade` in the student object.

In `sw.js`:
- Add `'js/benchmarks.js'` to the SHELL cache array.
- Bump the cache version string (increment the number in CACHE_NAME).
  </action>
  <verify>Create a new student with grade 4 selected. Confirm the student object in localStorage has `grade: 4`. Create one with no grade, confirm `grade: null`. Confirm sw.js lists benchmarks.js in cache.</verify>
  <done>Grade field available in student creation UI. addStudent accepts grade parameter. Service worker caches benchmarks.js.</done>
</task>

</tasks>

<verification>
1. `js/benchmarks.js` exists and exports HT_NORMS, getBenchmarkStatus, getSeason
2. `js/storage.js` is version 3 with grade field on students
3. Student creation UI has grade dropdown
4. sw.js caches benchmarks.js
5. Existing data migrates cleanly (no data loss)
</verification>

<success_criteria>
- Benchmarks module provides grade-level norms lookup for grades 1-6 with season detection
- Student profiles have optional grade field with v2->v3 migration
- Student creation UI includes grade selector
- Service worker updated
</success_criteria>

<output>
After completion, create `.planning/phases/07-teacher-reporting-benchmarks/07-01-SUMMARY.md`
</output>
