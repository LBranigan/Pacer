---
phase: 07-teacher-reporting-benchmarks
plan: 03
type: execute
wave: 2
depends_on: ["07-01"]
files_modified:
  - report.html
  - sw.js
autonomous: false

must_haves:
  truths:
    - "Teacher can print a complete RTI report with student info, trend chart, benchmark comparison, error breakdown, and assessment history"
    - "Report renders correctly in browser print preview (no UI chrome, proper pagination)"
    - "Chart image from celeration chart appears in the printed report"
    - "Benchmark norms and risk status appear in the report"
  artifacts:
    - path: "report.html"
      provides: "Printable RTI report page"
      min_lines: 100
  key_links:
    - from: "report.html"
      to: "js/storage.js"
      via: "import getStudents, getAssessments to load student data"
      pattern: "import.*storage"
    - from: "report.html"
      to: "js/benchmarks.js"
      via: "import getBenchmarkStatus, getSeason for norms comparison"
      pattern: "import.*benchmarks"
    - from: "report.html"
      to: "localStorage orf_report_student"
      via: "reads student ID passed from dashboard"
      pattern: "orf_report_student"
---

<objective>
Create the printable RTI report page that teachers can generate for formal meetings.

Purpose: Teachers need formal documentation of student reading progress for RTI meetings and parent conferences.
Output: report.html — a standalone page that reads student data from localStorage, renders a print-optimized report, and triggers window.print().
</objective>

<execution_context>
@/home/brani/.claude/get-shit-done/workflows/execute-plan.md
@/home/brani/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-teacher-reporting-benchmarks/07-RESEARCH.md
@.planning/phases/07-teacher-reporting-benchmarks/07-01-SUMMARY.md
@js/storage.js
@js/benchmarks.js
@dashboard.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create report.html with print-optimized RTI report</name>
  <files>report.html</files>
  <action>
Create `report.html` as a standalone HTML page. It reads `orf_report_student` from localStorage to get the student ID, then loads all data from storage.js.

**Page structure:**

1. **Header**: "Oral Reading Fluency Report" title, student name, grade, report generation date
2. **Trend Summary**:
   - Embed chart image via `localStorage.getItem('orf_report_chart')` (the dashboard will store a canvas.toDataURL snapshot before opening this page — handle gracefully if missing)
   - Summary table: Latest WCPM, previous WCPM, change (arrow up/down), latest accuracy, previous accuracy, change
3. **Benchmark Comparison**:
   - Current season auto-detected from latest assessment date
   - Show: student WCPM, grade, season, percentile thresholds (10th, 25th, 50th, 75th, 90th), risk classification with color
   - If no grade set, show "Grade not set — benchmarks unavailable"
4. **Error Analysis**:
   - From latest assessment's errorBreakdown: substitutions count, omissions count, insertions count
   - If alignment data exists, list the specific error words (first 10-15 max to avoid page overflow)
5. **Assessment History**:
   - Table with columns: Date, Passage (first 30 chars of passagePreview), WCPM, Accuracy, Errors
   - Show all assessments, most recent first
6. **Footer**: "Generated by ReadingQuest" + date, small print

**Print styles** (`@media print`):
- `@page { size: letter portrait; margin: 0.75in; }`
- Body: 11pt, black text, white background
- `.no-print { display: none !important; }` — hide the Print button and any screen-only elements
- `table { break-inside: avoid; }`, `h2 { break-after: avoid; }`
- No background colors in benchmark zones for print (use borders/hatching or rely on text labels)

**Screen styles**:
- Clean, readable layout with max-width 800px centered
- "Print Report" button at top (class `no-print`)
- "Back to Dashboard" link (class `no-print`)

**Script** (ES module):
- Import `getStudents`, `getAssessments` from `./js/storage.js`
- Import `getBenchmarkStatus`, `getSeason`, `HT_NORMS` from `./js/benchmarks.js`
- On DOMContentLoaded:
  - Read student ID from localStorage `orf_report_student`
  - Find student and their assessments
  - Sort assessments by date descending
  - Populate all report sections
  - If chart image in localStorage `orf_report_chart`, set it as img src
- Print button calls `window.print()`

Also update `sw.js`: add `'report.html'` to the SHELL cache array. (Only bump version if not already bumped in plan 01.)
  </action>
  <verify>From dashboard, click "Generate Report" for a student with assessments and grade set. Confirm report.html opens with all sections populated. Use Ctrl+P or click Print button — confirm print preview shows clean layout without buttons or nav elements.</verify>
  <done>report.html renders a complete, print-ready RTI report with trend data, benchmark comparison, error breakdown, and assessment history.</done>
</task>

<task type="auto">
  <name>Task 2: Wire chart snapshot from dashboard to report</name>
  <files>dashboard.html</files>
  <action>
In dashboard.html, update the "Generate Report" button handler to:
1. Before calling `window.open('report.html')`, capture the celeration chart canvas as a data URL: `document.querySelector('canvas').toDataURL('image/png')`
2. Store it in localStorage: `localStorage.setItem('orf_report_chart', dataUrl)`
3. Then open the report page

This ensures the trend chart appears in the printed report without re-rendering the chart module in report.html.

Handle edge case: if no canvas exists (no assessments), skip the snapshot step.
  </action>
  <verify>Generate report for student with multiple assessments. Confirm the chart image appears in the report page. Print preview should show the chart as a static image.</verify>
  <done>Chart snapshot transfers from dashboard to report via localStorage. Chart appears in printed report.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete RTI report generation flow: dashboard benchmark indicators, grade selector, and printable report page with trend chart, benchmark comparison, error analysis, and assessment history.</what-built>
  <how-to-verify>
    1. Open the app, select or create a student with grade set and at least 2 assessments
    2. Open dashboard — confirm benchmark bar shows colored zones with risk label
    3. Change grade via dropdown — confirm benchmark updates
    4. Click "Generate Report" — confirm report.html opens in new tab
    5. Verify report shows: student info, chart image, benchmark section with percentiles, error breakdown, assessment history table
    6. Press Ctrl+P — confirm print preview is clean (no buttons, proper margins, chart visible)
    7. Test with student who has no grade set — confirm "Grade not set" message in benchmark section
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. report.html exists and renders all 5 report sections
2. Print preview shows clean, professional layout
3. Chart image transfers from dashboard canvas
4. Benchmark comparison shows correct norms and risk status
5. Assessment history table lists all assessments
6. sw.js caches report.html
</verification>

<success_criteria>
- Teacher can generate a printable RTI report from the dashboard
- Report includes trend chart, benchmark comparison, error breakdown, and history
- Print preview is clean and professional
- Chart renders as static image in report
</success_criteria>

<output>
After completion, create `.planning/phases/07-teacher-reporting-benchmarks/07-03-SUMMARY.md`
</output>
