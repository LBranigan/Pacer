---
phase: 06-teacher-dashboard-celeration-chart
plan: 03
type: execute
wave: 2
depends_on: ["06-01", "06-02"]
files_modified:
  - js/dashboard.js
  - index.html
  - style.css
autonomous: false

must_haves:
  truths:
    - "Teacher sees a dashboard view with assessment results showing full error breakdown"
    - "Standard Celeration Chart renders in the dashboard with student data from localStorage"
    - "Chart auto-populates when student is selected -- no JSON import needed"
    - "Dashboard shows substitution, omission, and insertion counts plus word-level detail"
  artifacts:
    - path: "js/dashboard.js"
      provides: "Dashboard view controller with chart integration and error display"
      exports: ["initDashboard"]
      min_lines: 100
    - path: "index.html"
      provides: "Dashboard section with canvas, error breakdown area, chart controls"
      contains: "dashboardSection"
    - path: "style.css"
      provides: "Dashboard styling"
      contains: ".dashboard"
  key_links:
    - from: "js/dashboard.js"
      to: "js/celeration-chart.js"
      via: "import createChart"
      pattern: "createChart"
    - from: "js/dashboard.js"
      to: "js/storage.js"
      via: "import getAssessments"
      pattern: "getAssessments"
    - from: "js/dashboard.js"
      to: "index.html"
      via: "DOM manipulation of dashboard elements"
      pattern: "getElementById.*dashboard"
---

<objective>
Build the teacher dashboard view with assessment error breakdown display and embedded Standard Celeration Chart that auto-populates from localStorage.

Purpose: Satisfies TCHR-01 (error breakdown display), TCHR-02 (progress trends via chart), and the chart auto-population requirement.
Output: dashboard.js controller, HTML dashboard section, CSS styling, fully wired chart.
</objective>

<execution_context>
@/home/brani/.claude/get-shit-done/workflows/execute-plan.md
@/home/brani/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-teacher-dashboard-celeration-chart/06-RESEARCH.md
@.planning/phases/06-teacher-dashboard-celeration-chart/06-01-SUMMARY.md
@.planning/phases/06-teacher-dashboard-celeration-chart/06-02-SUMMARY.md
@js/storage.js
@js/celeration-chart.js
@index.html
@style.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add dashboard HTML section and create dashboard.js controller</name>
  <files>index.html, style.css, js/dashboard.js</files>
  <action>
**index.html changes:**
Add a new section after the history section (before the script tags) with id="dashboardSection" style="display:none":
- A heading "Student Dashboard"
- A div for chart controls: zoom buttons (1W, 1M, 3M, Full), metric toggles (checkboxes for Correct/Min, Errors/Min), celeration line toggle
- A canvas element id="celerationCanvas" with responsive width (100%, height ~400px via CSS)
- A div id="errorBreakdown" for the assessment error detail view
- An assessment list div id="dashboardAssessments" that shows each assessment as a clickable card with date, WCPM, accuracy, error counts
- When a card is clicked, errorBreakdown div expands to show: substitution count + list of (expected -> actual), omission count + list of missed words, insertion count + list of inserted words

**style.css changes:**
Add dashboard styles:
- `.dashboard` container with reasonable padding
- `.dashboard-chart` wrapper for the canvas (responsive, min-height 350px)
- `.chart-controls` flexbox row for zoom/metric buttons
- `.assessment-card` styled cards in a list (date, WCPM badge, accuracy, clickable)
- `.assessment-card.active` highlight for selected card
- `.error-breakdown` section: color-coded lists (red for substitutions with arrows, orange for omissions, blue for insertions)
- `.error-detail` individual error items
- Use existing app color palette where possible

**js/dashboard.js:**
Create as ES module exporting `initDashboard(getAssessmentsFn, getStudentsFn)`:

1. Import `createChart` from `./celeration-chart.js`
2. Import `getAssessment` from `./storage.js`

3. `initDashboard()` returns `{ show(studentId), hide() }`:
   - `show(studentId)`:
     a. Display dashboardSection, hide historySection
     b. Load assessments via getAssessmentsFn(studentId)
     c. If no assessments, show "No assessments yet" message
     d. Build data transformer: `toChartData(assessments)` that maps ReadingQuest assessments to chart format (as specified in RESEARCH.md):
        - Sort assessments by date
        - Compute firstDate from earliest assessment
        - For each assessment: `calendarDay = Math.floor((new Date(a.date) - firstDate) / 86400000)`, `correctPerMinute = a.wcpm || 0`, `errorsPerMinute = a.duration > 0 ? (a.errors || 0) / (a.duration / 60) : 0`
        - Return `[{ name: studentName, id: studentId, assessments: transformedArray }]`
     e. Create or update chart: `chart.setData(chartData)`
     f. Render assessment cards in dashboardAssessments div
     g. Wire zoom buttons to `chart.setZoom(days)`
     h. Wire metric toggles to `chart.setMetrics({})`
     i. Wire celeration line toggle to `chart.toggleCelerationLines(bool)`
   - `hide()`: hide dashboardSection, show historySection, call chart.destroy() if exists

4. Assessment card click handler:
   - Highlight selected card
   - If assessment has `errorBreakdown`, render it in errorBreakdown div:
     - Substitutions: count + table of "expected -> spoke" pairs from errorBreakdown.details where type==='substitution'
     - Omissions: count + list of missed words from errorBreakdown.details where type==='omission'
     - Insertions: count + list from errorBreakdown.details where type==='insertion'
   - If assessment has no errorBreakdown (old v1 data), show "Detailed breakdown not available for this assessment"
  </action>
  <verify>
1. Open the app in browser, no JS errors in console
2. Select a student with assessments
3. Dashboard section should be visible (need to wire the show trigger -- see Task 2 wiring note)
  </verify>
  <done>Dashboard section exists in HTML with chart canvas, controls, assessment cards, and error breakdown area. dashboard.js creates chart from localStorage data and renders error details on card click.</done>
</task>

<task type="auto">
  <name>Task 2: Wire dashboard into app.js and add view toggle</name>
  <files>js/app.js, js/ui.js</files>
  <action>
In `js/app.js`:
1. Import `initDashboard` from `./dashboard.js`
2. After `refreshStudentUI()` at the bottom, initialize: `const dashboard = initDashboard(getAssessments, getStudents)`
3. Add a "View Dashboard" button click handler: when student is selected and user clicks the button, call `dashboard.show(appState.selectedStudentId)`. Add corresponding button in the student bar area or history section header.
4. After `refreshStudentUI()` is called post-assessment-save, also refresh dashboard if it's visible.
5. Wire a "Back to History" button (inside dashboard section) to call `dashboard.hide()`.

In `js/ui.js`:
- If any rendering helpers are needed for the dashboard cards, add them. But prefer keeping dashboard.js self-contained.

In `index.html`:
- Add a "Dashboard" button next to the history section heading, visible only when student is selected
- Style it consistently with existing buttons
  </action>
  <verify>
1. Open app, select a student
2. Click "Dashboard" button -- dashboard section appears with chart and assessment cards
3. Click an assessment card -- error breakdown appears below
4. Click zoom buttons -- chart re-renders at different zoom levels
5. Click "Back" -- returns to history view
  </verify>
  <done>Dashboard is accessible via button click when student selected. Chart auto-populates from localStorage. Error breakdown displays on assessment card click. Navigation between history and dashboard works.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Teacher dashboard with Standard Celeration Chart and error breakdown display. Chart renders assessment data on semi-log canvas. Assessment cards show error details when clicked.</what-built>
  <how-to-verify>
1. Open the app and select a student (create one and run an assessment if needed)
2. Click the "Dashboard" button
3. Verify the Standard Celeration Chart renders with the cream/navy vintage aesthetic
4. Verify data points appear on the chart (dots for correct/min, X for errors/min)
5. Click zoom buttons (1W, 1M, 3M, Full) -- chart should re-render at different scales
6. Click an assessment card -- verify error breakdown shows substitutions (expected->actual), omissions, insertions with counts
7. Click "Back" to return to history view
8. Verify no visual glitches or layout issues
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues</resume-signal>
</task>

</tasks>

<verification>
1. Dashboard displays when student selected and button clicked
2. Chart renders with correct semi-log grid and data points
3. Error breakdown shows detailed per-word errors
4. Chart auto-populates from localStorage -- no manual import
5. Navigation between history and dashboard is smooth
</verification>

<success_criteria>
- TCHR-01: Error breakdown with substitutions, omissions, insertions visible
- TCHR-02: Progress trends visible on Standard Celeration Chart
- Chart populates automatically from localStorage assessments
- Dashboard is navigable and visually consistent with app
</success_criteria>

<output>
After completion, create `.planning/phases/06-teacher-dashboard-celeration-chart/06-03-SUMMARY.md`
</output>
