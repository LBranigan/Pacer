---
phase: 06-teacher-dashboard-celeration-chart
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - js/celeration-chart.js
autonomous: true

must_haves:
  truths:
    - "Chart renders a 6-cycle semi-logarithmic grid on a canvas element"
    - "Data points appear as dots (correct/min) and X marks (errors/min) at correct positions"
    - "Chart supports zoom presets and pan controls"
    - "Celeration lines are computed and drawn through data series"
  artifacts:
    - path: "js/celeration-chart.js"
      provides: "ES module port of standalone celeration chart"
      exports: ["createChart"]
      min_lines: 400
  key_links:
    - from: "js/celeration-chart.js"
      to: "Canvas 2D API"
      via: "getContext('2d') drawing calls"
      pattern: "getContext.*2d"
---

<objective>
Port the standalone Standard Celeration Chart rendering engine into an ES module that can be embedded in the ReadingQuest dashboard.

Purpose: The standalone project at "C:\Users\brani\Desktop\standard celeration chart\app.js" contains ~1600 lines of production-quality chart rendering. This plan extracts the rendering core as a reusable ES module, removing file-upload UI and global state.
Output: js/celeration-chart.js -- a self-contained ES module exporting `createChart(canvasEl, options)`.
</objective>

<execution_context>
@/home/brani/.claude/get-shit-done/workflows/execute-plan.md
@/home/brani/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-teacher-dashboard-celeration-chart/06-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Port standalone chart rendering as ES module</name>
  <files>js/celeration-chart.js</files>
  <action>
Read the standalone chart at `/mnt/c/Users/brani/Desktop/standard celeration chart/app.js` (all 1577 lines).

Create `js/celeration-chart.js` as an ES module by extracting and adapting the standalone code:

1. **CONFIG**: Copy the full CONFIG object as a module-level const (colors, grid lines, zoom levels, symbols, margins). Keep all values identical.

2. **createChart(canvasEl, options = {})**: The single exported factory function. Returns an API object. Internally:
   - Merge `options` into a local copy of CONFIG
   - Create internal `state` object (replaces window.state): `{ students: [], activeStudents: new Set(), activeMetrics: { correctPerMinute: true, errorsPerMinute: true }, displayOptions: { showCelerationLines: true, showGrid: true, showTooltips: true }, zoom: { level: 140, panOffset: 0 }, canvas: canvasEl, ctx: canvasEl.getContext('2d') }`
   - Port `resizeCanvas()` with DPI scaling (devicePixelRatio)
   - Port all drawing functions: `drawChart`, `drawGrid`, `drawAxes`, `drawDataSeries`, `drawCelerationLine`, `drawDot`, `drawXMark`, `drawQuestionMark`, `valueToY`, `dayToX`
   - Port `calculateCeleration(dataPoints)` and `formatCeleration(value)` for celeration line math
   - Port `detectPatterns(assessments)` and `detectConsecutiveDeclines(values, threshold)`
   - Port tooltip handling: `handleMouseMove` for hover tooltips on data points
   - Wire ResizeObserver on canvasEl to call resizeCanvas + redraw
   - Wire mousemove on canvasEl for tooltips

3. **Returned API object**:
   - `setData(students)` -- accepts array of `{ name, id, assessments[] }` where each assessment has `{ celeration: { calendarDay, correctPerMinute, errorsPerMinute, ... }, performance: { ... } }`. Stores in state.students, sets all as active, calls drawChart.
   - `setMetrics(metrics)` -- e.g. `{ correctPerMinute: true, errorsPerMinute: false }`. Updates state.activeMetrics, redraws.
   - `setZoom(days)` -- sets zoom level (7/30/90/140), resets pan, redraws.
   - `pan(direction)` -- 'left' or 'right', shifts panOffset by 7 days, redraws.
   - `toggleCelerationLines(show)` -- toggles celeration line display.
   - `destroy()` -- removes event listeners, disconnects ResizeObserver.

4. **Key changes from standalone**:
   - Remove ALL global state (`window.state`, `window.CONFIG`). Everything is encapsulated.
   - Remove file upload/import UI code, student management sidebar, save/export functions.
   - Remove `processStudentData` (data arrives pre-formatted via `setData`).
   - Remove DOM manipulation for controls (zoom buttons, metric checkboxes) -- the dashboard will create its own UI.
   - Keep the drawing math IDENTICAL to standalone -- do not simplify or modify the rendering logic.

5. **Do NOT include**: HTML generation, file handlers, localStorage access, student CRUD. This module is purely rendering.
  </action>
  <verify>
1. File exists at js/celeration-chart.js
2. `import { createChart } from './js/celeration-chart.js'` resolves without error in browser console
3. Quick smoke test: create a temporary canvas in console, call createChart, call setData with mock data, verify no JS errors:
```javascript
const c = document.createElement('canvas'); c.width=800; c.height=600; document.body.appendChild(c);
const chart = createChart(c);
chart.setData([{ name:'Test', id:'t1', assessments: [{ celeration: { calendarDay: 0, correctPerMinute: 50, errorsPerMinute: 5, countingTimeSec: 60, countingTimeMin: 1, date: '2026-01-01' }, performance: { totalWords: 55, correctCount: 50, accuracy: 90.9, wpm: 50 } }] }]);
```
Canvas should show a semi-log grid with at least one data point visible.
  </verify>
  <done>celeration-chart.js is a self-contained ES module exporting createChart. Renders 6-cycle semi-log SCC with data points, celeration lines, zoom, pan, tooltips. No globals, no DOM dependencies beyond the canvas element.</done>
</task>

</tasks>

<verification>
1. Module imports cleanly with no side effects
2. Chart renders correctly with mock data
3. Zoom presets change the x-axis range
4. Zero error values handled (? symbol, not crash)
</verification>

<success_criteria>
- createChart accepts a canvas and renders a Standard Celeration Chart
- All drawing math ported identically from standalone
- No window globals, fully encapsulated state
- API: setData, setMetrics, setZoom, pan, toggleCelerationLines, destroy
</success_criteria>

<output>
After completion, create `.planning/phases/06-teacher-dashboard-celeration-chart/06-02-SUMMARY.md`
</output>
