* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: 'Segoe UI', system-ui, sans-serif; background: #f5f5f5; color: #222; padding: 2rem; max-width: 900px; margin: 0 auto; }
h1 { margin-bottom: 0.5rem; }
.subtitle { color: #666; margin-bottom: 1.5rem; }
label { font-weight: 600; display: block; margin-bottom: 0.25rem; }
input[type=text], textarea { width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; font-size: 0.95rem; font-family: inherit; }
textarea { min-height: 100px; resize: vertical; }
.section { background: #fff; border-radius: 8px; padding: 1.25rem; margin-bottom: 1rem; box-shadow: 0 1px 3px rgba(0,0,0,0.08); }
button { padding: 0.6rem 1.4rem; border: none; border-radius: 4px; font-size: 1rem; cursor: pointer; font-weight: 600; }
#recordBtn { background: #d32f2f; color: #fff; }
#recordBtn.recording { background: #b71c1c; animation: pulse 1s infinite; }
#recordBtn:disabled { background: #999; }
@keyframes pulse { 0%,100% { opacity:1; } 50% { opacity:0.6; } }
#uploadBtn { background: #1976d2; color: #fff; margin-left: 0.5rem; }
#status { margin-top: 0.75rem; font-style: italic; color: #555; }
.result-box { background: #fafafa; border: 1px solid #ddd; border-radius: 4px; padding: 1rem; margin-top: 0.75rem; white-space: pre-wrap; font-family: 'Consolas', monospace; font-size: 0.9rem; max-height: 800px; overflow-y: auto; }
.word { display: inline-block; margin: 2px; padding: 2px 4px; border-radius: 3px; cursor: default; }
.word.high { background: none; text-decoration: underline wavy #4caf50; text-underline-offset: 3px; }
.word.mid { background: none; text-decoration: underline wavy #ff9800; text-underline-offset: 3px; }
.word.low { background: none; text-decoration: underline wavy #f44336; text-underline-offset: 3px; }
/* Legacy .word-correct/.word-substitution/.word-omission/.word-insertion removed — see docs/legacy/ */
.word-clickable { cursor: pointer; }
.word-clickable:hover { outline: 2px solid #1976d2; outline-offset: 1px; border-radius: 2px; }
.legend { display: flex; flex-wrap: wrap; gap: 0.5rem; margin-top: 0.5rem; font-size: 0.8rem; }
.legend span { padding: 2px 6px; border-radius: 3px; cursor: help; white-space: nowrap; }
.controls { display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; }
.timer { font-variant-numeric: tabular-nums; font-size: 1.1rem; font-weight: 600; color: #d32f2f; min-width: 3rem; }

/* Metrics summary bar */
.metrics-bar { display: flex; gap: 1rem; flex-wrap: wrap; }
.metric-box { background: #f5f5f5; border: 1px solid #ddd; border-radius: 6px; padding: 0.75rem 1rem; text-align: center; min-width: 80px; }
.metric-box-errors { flex: 1; text-align: left; display: flex; align-items: center; }
.metric-value { display: block; font-size: 1.5rem; font-weight: 700; color: #333; }
.metric-label { display: block; font-size: 0.8rem; color: #666; font-weight: 600; }

/* Data quality warning */
.data-quality-warning {
  background: #fff3e0; border: 2px solid #e65100; border-radius: 6px;
  padding: 0.75rem 1rem; margin-top: 0.75rem;
  color: #bf360c; font-size: 0.9rem; line-height: 1.4;
}

/* Diagnostic overlays */
.word-hesitation { border-left: 3px solid #ff9800; padding-left: 4px; }
.pause-indicator { color: #999; font-size: 0.75rem; margin: 0 2px; font-style: italic; }
.word-morphological { text-decoration: underline wavy #e65100; text-underline-offset: 3px; }

#analyzeBtn { background: #d32f2f; color: #fff; font-size: 1.1rem; padding: 0.7rem 2rem; }
#analyzeBtn:disabled { background: #999; cursor: not-allowed; }

/* Student selector bar */
.student-bar { }
.student-controls { display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; margin-top: 0.25rem; }
#studentSelect { flex: 1; min-width: 140px; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; font-size: 0.95rem; }
#newStudentName { flex: 1; min-width: 120px; }
#addStudentBtn { background: #388e3c; color: #fff; }
#deleteStudentBtn { background: #c62828; color: #fff; }

/* History table */
#historySection table { width: 100%; border-collapse: collapse; font-size: 0.9rem; margin-top: 0.5rem; }
#historySection th, #historySection td { padding: 0.4rem 0.6rem; border-bottom: 1px solid #e0e0e0; text-align: left; }
#historySection th { background: #f5f5f5; font-weight: 600; font-size: 0.8rem; color: #555; }
#historySection tr:hover { background: #fafafa; }

/* Dashboard */
.dashboard { padding: 1.25rem; }
.dashboard-chart { margin-bottom: 1.5rem; }
.dashboard-chart canvas { width: 100%; height: 400px; display: block; }
.chart-controls { display: flex; align-items: center; gap: 0.5rem; flex-wrap: wrap; margin-bottom: 0.75rem; font-size: 0.85rem; }
.zoom-btn { padding: 0.3rem 0.7rem; font-size: 0.8rem; background: #e0e0e0; color: #333; border: 1px solid #bbb; border-radius: 3px; cursor: pointer; font-weight: 600; }
.zoom-btn.active { background: #1565c0; color: #fff; border-color: #1565c0; }
.metric-toggle { display: inline-flex; align-items: center; gap: 0.25rem; font-weight: 400; font-size: 0.85rem; margin-bottom: 0; cursor: pointer; }
.metric-toggle input { cursor: pointer; }

/* Assessment cards */
.dashboard-assessments { display: flex; flex-direction: column; gap: 0.5rem; margin-bottom: 1rem; max-height: 300px; overflow-y: auto; }
.assessment-card { background: #fafafa; border: 1px solid #ddd; border-radius: 6px; padding: 0.75rem 1rem; cursor: pointer; transition: border-color 0.15s, box-shadow 0.15s; }
.assessment-card:hover { border-color: #1565c0; box-shadow: 0 1px 4px rgba(21,101,192,0.15); }
.assessment-card.active { border-color: #1565c0; background: #e3f2fd; box-shadow: 0 1px 4px rgba(21,101,192,0.2); }
.card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.25rem; }
.card-date { font-weight: 600; color: #333; }
.card-wcpm { background: #1565c0; color: #fff; padding: 0.15rem 0.5rem; border-radius: 3px; font-size: 0.8rem; font-weight: 700; }
.card-stats { font-size: 0.8rem; color: #666; display: flex; justify-content: space-between; }
.card-errors { font-family: 'Consolas', monospace; }
.dashboard-empty { color: #999; font-style: italic; padding: 1rem 0; }

/* Error breakdown */
.error-breakdown { background: #fafafa; border: 1px solid #ddd; border-radius: 6px; padding: 1rem; }
.error-section { margin-bottom: 1rem; }
.error-section:last-child { margin-bottom: 0; }
.error-section h4 { font-size: 0.9rem; margin-bottom: 0.5rem; }
.error-substitutions h4 { color: #e65100; }
.error-omissions h4 { color: #c62828; }
.error-insertions h4 { color: #1565c0; }
.error-section table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
.error-section th, .error-section td { padding: 0.25rem 0.5rem; border-bottom: 1px solid #eee; text-align: left; }
.error-section th { font-size: 0.75rem; color: #888; }
.error-section .arrow { text-align: center; color: #e65100; font-weight: 700; }
.error-section ul { list-style: none; display: flex; flex-wrap: wrap; gap: 0.4rem; }
.error-omissions li { background: #ffcdd2; color: #c62828; padding: 0.15rem 0.5rem; border-radius: 3px; font-size: 0.85rem; }
.error-insertions li { background: #bbdefb; color: #1565c0; padding: 0.15rem 0.5rem; border-radius: 3px; font-size: 0.85rem; }
.error-detail { color: #999; font-style: italic; }

/* Audio playback */
.playback-controls { display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.75rem; }
.playback-play-btn { background: #1976d2; color: #fff; padding: 0.4rem 1rem; border: none; border-radius: 4px; font-weight: 600; cursor: pointer; min-width: 70px; }
.playback-progress { flex: 1; cursor: pointer; }
.playback-time { font-size: 0.85rem; color: #555; font-variant-numeric: tabular-nums; min-width: 90px; text-align: right; }
.playback-words { line-height: 2; padding: 0.5rem 0; }
.playback-word { display: inline-block; padding: 2px 6px; margin: 2px; border-radius: 12px; font-size: 0.95rem; transition: background-color 0.1s; }
.playback-word.correct { background: #e8f5e9; color: #2e7d32; }
.playback-word.substitution { background: #ffebee; color: #c62828; }
.playback-word.omission { background: #fff3e0; color: #e65100; text-decoration: line-through; }
.playback-word.insertion { background: #e3f2fd; color: #1565c0; }
.playback-word.speaking { background: #fff176; color: #222; box-shadow: 0 0 0 2px #fdd835; }
.playback-no-audio { color: #999; font-style: italic; margin: 0.5rem 0; }
#audioPlaybackArea { margin-top: 1rem; }

/* NL tier indicators */
.word-tier-proper { text-decoration: underline dotted #7b1fa2; text-underline-offset: 3px; }
.word-tier-academic { font-weight: 500; }
.word-tier-sight { }
.word-tier-function { }
.word-forgiven { position: relative; border: 2px dashed #4caf50; }
.word-forgiven::after { content: '✓'; position: absolute; top: -8px; right: -6px; font-size: 0.7rem; color: #4caf50; font-weight: bold; background: #fff; border-radius: 50%; padding: 0 2px; }
.tier-breakdown { display: flex; gap: 1rem; flex-wrap: wrap; width: 100%; margin-top: 0.5rem; }
.tier-item { font-size: 0.85rem; color: #555; font-weight: 600; }

/* VAD Settings (Phase 12) */
/* Backend connection settings */
.backend-settings { display: flex; flex-direction: column; gap: 0.5rem; }
.backend-field label { font-weight: 400; font-size: 0.9rem; margin-bottom: 0.1rem; }
.backend-field input { width: 100%; padding: 0.4rem 0.5rem; border: 1px solid #ccc; border-radius: 4px; font-size: 0.9rem; font-family: 'Consolas', monospace; }
.backend-status { display: flex; align-items: center; gap: 0.75rem; margin-top: 0.25rem; }
.backend-status button { background: #1976d2; color: #fff; padding: 0.4rem 0.8rem; font-size: 0.85rem; }
#backendStatusText { font-size: 0.85rem; color: #666; }
#backendStatusText.ok { color: #2e7d32; }
#backendStatusText.err { color: #c62828; }

.vad-settings { display: flex; flex-direction: column; gap: 0.75rem; }
.vad-calibration { display: flex; align-items: center; gap: 1rem; }
.vad-calibration button { background: #1976d2; color: #fff; padding: 0.5rem 1rem; border: none; border-radius: 4px; cursor: pointer; font-weight: 600; }
.vad-calibration button:disabled { background: #666; cursor: not-allowed; }
.vad-threshold { display: flex; flex-direction: column; gap: 0.25rem; }
.vad-threshold label { font-weight: 400; font-size: 0.9rem; }
.vad-threshold input[type="range"] { width: 200px; }
.vad-presets { display: flex; gap: 0.5rem; margin-top: 0.25rem; }
.vad-preset { padding: 0.3rem 0.6rem; border: 1px solid #ccc; border-radius: 4px; background: #f5f5f5; color: #555; cursor: pointer; font-size: 0.8rem; }
.vad-preset:hover { background: #e0e0e0; }
.vad-info { font-size: 0.9rem; color: #666; }
.vad-info.high-noise { color: #e65100; }

/* Rate anomaly - dashed underline (Phase 16) */
.word-rate-anomaly {
  text-decoration: underline dashed;
  text-decoration-color: #e65100;
  text-underline-offset: 3px;
}

/* Disfluency badges - superscript position (Phase 16) */
.word-with-disfluency {
  position: relative;
  display: inline-block;
}

.disfluency-badge {
  position: absolute;
  top: -6px;
  right: -6px;
  font-size: 0.65rem;
  line-height: 1;
  z-index: 10;
  pointer-events: auto;
  cursor: help;
}

/* Severity colors per CONTEXT.md */
.disfluency-badge.minor { color: #ffc107; }      /* Yellow - single dot */
.disfluency-badge.moderate { color: #ff9800; }   /* Orange - double dot */
.disfluency-badge.significant { color: #f44336; } /* Red - warning icon */

/* Prevent badge crowding adjacent words */
.word-with-disfluency + .word {
  margin-left: 4px;
}

/* WCPM range display (Phase 16) */
.wcpm-container {
  display: flex;
  flex-direction: column;
  align-items: center;
}

.wcpm-primary {
  font-size: 1.5rem;
  font-weight: 700;
  color: #333;
  line-height: 1.2;
}

.wcpm-range {
  font-size: 0.75rem;
  color: #666;
  margin-top: 0.1rem;
}

.wcpm-label {
  font-size: 0.8rem;
  color: #666;
  font-weight: 600;
  margin-top: 0.25rem;
}

/* Fluency concerns summary (Phase 16) */
.fluency-summary {
  font-size: 0.8rem;
  color: #666;
  margin-top: 0.5rem;
  text-align: center;
}

.fluency-summary .significant { color: #f44336; font-weight: 600; }
.fluency-summary .moderate { color: #ff9800; }
.fluency-summary .minor { color: #ffc107; }

/* Dev mode toggle (Phase 16) */
.dev-mode-only {
  display: none !important;
}

body.dev-mode .dev-mode-only {
  display: block !important;
}

/* Cross-validator engine toggle (Phase C) */
.xval-engine-options {
  display: flex;
  gap: 1.5rem;
  margin-top: 0.25rem;
}

.xval-engine-options label {
  font-weight: 400;
  display: flex;
  align-items: center;
  gap: 0.4rem;
  cursor: pointer;
}

/* Dev mode toggle button */
.dev-mode-toggle {
  position: fixed;
  bottom: 10px;
  right: 10px;
  background: #666;
  color: #fff;
  border: none;
  border-radius: 4px;
  padding: 0.4rem 0.8rem;
  font-size: 0.75rem;
  cursor: pointer;
  opacity: 0.6;
  z-index: 1000;
}

.dev-mode-toggle:hover {
  opacity: 1;
}

body.dev-mode .dev-mode-toggle {
  background: #7b1fa2;
  opacity: 1;
}

/* VAD calibration spinner (Phase 16) */
.vad-spinner {
  display: inline-block;
  width: 16px;
  height: 16px;
  border: 2px solid #ccc;
  border-top-color: #1976d2;
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
  margin-right: 0.5rem;
  vertical-align: middle;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Legacy analyzed section CSS removed — see docs/legacy/ */

/* STT Transcript section (collapsible) */
.stt-transcript-section {
  margin-top: 1rem;
  border: 1px solid #ddd;
  border-radius: 6px;
  overflow: hidden;
}

.stt-transcript-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.5rem 0.75rem;
  background: #f5f5f5;
  cursor: pointer;
  user-select: none;
}

.stt-transcript-header:hover {
  background: #eee;
}

.stt-transcript-header h4 {
  font-size: 0.9rem;
  font-weight: 600;
  color: #555;
  margin: 0;
}

.stt-transcript-toggle {
  font-size: 0.8rem;
  color: #888;
  transition: transform 0.2s;
}

.stt-transcript-section.expanded .stt-transcript-toggle {
  transform: rotate(180deg);
}

.stt-transcript-body {
  display: none;
  padding: 0.75rem;
  background: #fafafa;
}

.stt-transcript-section.expanded .stt-transcript-body {
  display: block;
}

.stt-transcript-words {
  line-height: 2;
}

/* STT source rows */
.stt-source-row {
  margin-bottom: 0.75rem;
}

.stt-source-row:last-child {
  margin-bottom: 0;
}

.stt-source-label {
  font-size: 0.8rem;
  font-weight: 600;
  margin-bottom: 0.25rem;
  padding: 2px 8px;
  border-radius: 3px;
  display: inline-block;
}

.stt-source-words {
  line-height: 2;
}

.stt-no-data {
  color: #999;
  font-style: italic;
  font-size: 0.85rem;
}

/* Per-engine word colors */
.conf-word {
  display: inline-block;
  margin: 2px;
  padding: 2px 6px;
  border-radius: 3px;
  font-size: 0.9rem;
}

.stt-reverb-v1.stt-source-label {
  background: #e3f2fd;
  color: #1565c0;
}

.conf-word.stt-reverb-v1 {
  background: #e3f2fd;
  color: #1565c0;
}

.stt-reverb-v0.stt-source-label {
  background: #e8f5e9;
  color: #2e7d32;
}

.conf-word.stt-reverb-v0 {
  background: #e8f5e9;
  color: #2e7d32;
}

.stt-parakeet.stt-source-label {
  background: #f3e5f5;
  color: #7b1fa2;
}

.conf-word.stt-parakeet {
  background: #f3e5f5;
  color: #7b1fa2;
}

/* STT Transcript verdict coloring (Plan 5: Reference-Anchored Cross-Validation) */
.conf-word.stt-verdict-correct {
  background: #e8f5e9;
  color: #2e7d32;
}

.conf-word.stt-verdict-error {
  background: #ffebee;
  color: #c62828;
}

.conf-word.stt-verdict-disfluency {
  background: #fff3e0;
  color: #e65100;
  font-style: italic;
}

/* Pipeline Trace Steps */
.pipeline-step {
  margin-bottom: 0.75rem;
  border: 1px solid #e0e0e0;
  border-radius: 6px;
  overflow: hidden;
}

.pipeline-step-header {
  background: #f5f5f5;
  padding: 6px 10px;
  font-size: 0.85rem;
  border-bottom: 1px solid #e0e0e0;
}

.pipeline-step-num {
  display: inline-block;
  background: #1565c0;
  color: #fff;
  width: 20px;
  height: 20px;
  border-radius: 50%;
  text-align: center;
  line-height: 20px;
  font-size: 0.7rem;
  font-weight: 700;
}

.pipeline-step-desc {
  color: #888;
  font-size: 0.78rem;
}

.pipeline-step-body {
  padding: 8px 10px;
  overflow-x: auto;
}

.pipeline-step-summary {
  font-size: 0.78rem;
  color: #888;
  margin-top: 6px;
  padding-top: 4px;
  border-top: 1px solid #eee;
}

/* Step 1: Word rows */
.pipeline-word-row {
  display: flex;
  align-items: baseline;
  gap: 6px;
  margin-bottom: 4px;
  flex-wrap: wrap;
}

.pipeline-row-label {
  font-weight: 600;
  font-size: 0.78rem;
  white-space: nowrap;
  min-width: 140px;
  flex-shrink: 0;
}

.pipeline-src-v1 { color: #1565c0; }
.pipeline-src-v0 { color: #2e7d32; }
.pipeline-src-pk { color: #7b1fa2; }

.pipeline-row-words {
  font-size: 0.82rem;
  line-height: 1.6;
}

.pipeline-word {
  display: inline-block;
  padding: 1px 4px;
  border-radius: 3px;
  background: #f8f8f8;
  border: 1px solid #e0e0e0;
  cursor: default;
}

.pipeline-word:hover {
  background: #e3f2fd;
}

/* Step 1: Three-Engine Consensus table */
.engine-correct    { color: #2e7d32; background: #e8f5e9; font-weight: 600; }
.engine-compound   { color: #e65100; background: #fff3e0; font-weight: 600; }
.engine-sub        { color: #c62828; background: #ffebee; font-weight: 600; }
.engine-omit       { color: #999; font-style: italic; background: #fafafa; }
.engine-unavailable { color: #bbb; font-style: italic; }
.engine-compound-frags { font-size: 0.7rem; color: #6a1b9a; margin-top: 2px; }
.engine-fused-tag { font-size: 0.7rem; color: #6a1b9a; font-weight: 400; font-style: italic; }
.pipeline-verdict-omission { color: #999; font-style: italic; }

/* Insertion sub-rows in Step 1 consensus table */
.pipeline-insertion-row { background: #f9f6ff; }
.pipeline-insertion-row td { font-size: 0.8rem; padding-top: 2px; padding-bottom: 2px; }
.pipeline-ins-idx { color: #9e9e9e; }
.pipeline-ins-ref { color: #bbb; }
.engine-ins { color: #6a1b9a; font-style: italic; }
.engine-ins-absent { color: #bbb; font-size: 0.75rem; font-style: italic; }
.engine-ins-different { color: #e65100; font-size: 0.75rem; font-style: italic; }
.pipeline-verdict-insertion { color: #6a1b9a; font-size: 0.8rem; }

/* Engine section headings in Step 2 */
.pipeline-engine-section {
  margin-bottom: 0.75rem;
}

.pipeline-engine-heading {
  font-weight: 700;
  font-size: 0.8rem;
  color: #555;
  margin-bottom: 0.25rem;
  padding: 2px 0;
  border-bottom: 1px solid #e0e0e0;
}

/* Steps 1-4: Tables */
.pipeline-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.78rem;
}

.pipeline-table th {
  background: #f5f5f5;
  padding: 4px 8px;
  text-align: left;
  font-weight: 600;
  border-bottom: 2px solid #ddd;
  white-space: nowrap;
}

.pipeline-table td {
  padding: 3px 8px;
  border-bottom: 1px solid #eee;
  vertical-align: top;
}

.pipeline-table tbody tr:hover {
  background: #f8f9fa;
}

.pipeline-td-idx {
  color: #bbb;
  text-align: right;
  width: 30px;
}

.pipeline-td-ref {
  font-weight: 600;
}

.pipeline-td-correct { color: #2e7d32; background: #e8f5e9; }
.pipeline-td-sub { color: #c62828; background: #ffebee; }
.pipeline-td-omission { color: #999; font-style: italic; background: #fafafa; }
.pipeline-v2-fragments { font-size: 0.7rem; color: #e65100; margin-top: 2px; }

.pipeline-td-type { font-size: 0.72rem; }
.pipeline-td-type-correct { color: #2e7d32; }
.pipeline-td-type-substitution { color: #c62828; }
.pipeline-td-type-omission { color: #999; }
.pipeline-td-type-insertion { color: #1565c0; }
.pipeline-td-type-struggle { color: #d84315; }

.pipeline-td-reason {
  color: #888;
  font-size: 0.72rem;
}

/* Cross-validation verdict colors */
.pipeline-verdict-confirmed { color: #2e7d32; font-weight: 600; }
.pipeline-verdict-disagreed { color: #c62828; font-weight: 600; }
.pipeline-verdict-recovered { color: #1565c0; font-weight: 600; }
.pipeline-verdict-unconfirmed { color: #e65100; font-weight: 600; }

/* Row highlighting for xval status */
.pipeline-xval-disagreed { background: #fff8f8; }
.pipeline-xval-recovered { background: #f8f8ff; }
.pipeline-xval-unconfirmed { background: #fffaf5; }

/* Final alignment row colors */
.pipeline-final-correct { }
.pipeline-final-substitution { background: #fff8f8; }
.pipeline-final-omission { background: #fafafa; }
.pipeline-final-insertion { background: #f5f8ff; }
.pipeline-final-struggle { background: #fff5f0; }

/* Step 0: Raw Engine Output — anchor-aligned table */
.pipeline-raw-table td { font-family: 'SF Mono', 'Consolas', 'Monaco', monospace; font-size: 0.76rem; }
.pipeline-raw-anchor-row { background: #f0f7f0; }
.pipeline-raw-anchor-row .pipeline-td-idx { color: #2e7d32; font-weight: 700; }
.pipeline-raw-gap-row { background: #fffbf0; }
.pipeline-raw-gap-row .pipeline-td-idx { color: transparent; }
.pipeline-raw-anchor { font-weight: 600; }
.pipeline-raw-nonanchor { color: #c62828; }
.pipeline-raw-empty { background: #fafafa; }
.pipeline-raw-word { margin-right: 6px; }
.pipeline-raw-ts { color: #aaa; font-size: 0.68rem; white-space: nowrap; }

/* Step 3: Post-processing lists */
.pipeline-insertions {
  font-size: 0.8rem;
  color: #666;
  padding: 4px 8px;
  margin-top: 4px;
  background: #fafafa;
  border-radius: 3px;
}

.pipeline-pp-section {
  margin-bottom: 6px;
}

.pipeline-pp-label {
  font-weight: 600;
  font-size: 0.8rem;
  color: #444;
}

.pipeline-pp-recovered .pipeline-pp-label { color: #1565c0; }
.pipeline-pp-compound .pipeline-pp-label { color: #2e7d32; }
.pipeline-pp-struggle .pipeline-pp-label { color: #d84315; }
.pipeline-pp-absorbed .pipeline-pp-label { color: #e65100; }
.pipeline-pp-artifact .pipeline-pp-label { color: #999; }
.pipeline-pp-forgiven .pipeline-pp-label { color: #00695c; }
.pipeline-pp-confinsertion .pipeline-pp-label { color: #6a1b9a; font-weight: 600; }

.pipeline-pp-list {
  margin: 2px 0 0 18px;
  padding: 0;
  font-size: 0.78rem;
  color: #555;
}

.pipeline-pp-list li {
  margin-bottom: 2px;
}

/* Struggle word indicator (DIAG-07)
 * Highlights words where student showed decoding difficulty:
 * 1. Pause/hesitation before word
 * 2. ASR struggled with word
 * 3. Word length > 3 chars (not a sight word)
 * Distinct style: teal/cyan with dotted border - stands out from other indicators
 */
/* Legacy .word-struggle/.word-hesitation.word-struggle removed — see docs/legacy/ */

/* VAD Gap UI Display (Phase 19)
 * Orange color for pause/hesitation indicators with VAD speech >= 30%
 * Helps teachers distinguish gaps with speech activity from true silence
 */
.pause-indicator-vad {
  color: #ff9800;  /* Orange - differentiates from default gray */
}

.word-hesitation-vad {
  border-left-color: #ff9800;  /* Orange left border instead of default orange */
}


/* Collapsible prosody section */
.prosody-section {
  border: 1px solid #ddd;
  border-radius: 6px;
  overflow: hidden;
}

.prosody-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.5rem 0.75rem;
  background: #f5f5f5;
  cursor: pointer;
  user-select: none;
}

.prosody-header:hover {
  background: #eee;
}

.prosody-header h4 {
  font-size: 0.9rem;
  font-weight: 600;
  color: #555;
  margin: 0;
}

.prosody-toggle {
  font-size: 0.8rem;
  color: #888;
  transition: transform 0.2s;
}

.prosody-section.expanded .prosody-toggle {
  transform: rotate(180deg);
}

.prosody-body {
  display: none;
  padding: 0.75rem;
  background: #fafafa;
}

.prosody-section.expanded .prosody-body {
  display: block;
}

.prosody-metrics {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.prosody-metrics .metric-box {
  flex: 1 1 120px;
  min-width: 120px;
}

.prosody-warning {
  color: #b45309;
  font-weight: 500;
  padding: 4px 8px;
  background: #fef3c7;
  border-radius: 3px;
  margin-bottom: 8px;
  font-size: 0.85em;
}

.prosody-scope-note {
  margin-top: 10px;
  font-size: 0.78em;
  color: #999;
  border-top: 1px solid #eee;
  padding-top: 6px;
}

/* Prosody dedicated container */
.prosody-container {
  margin-top: 1rem;
}

/* ───────────────────────────────────────────────────────────────────────────
   Word Speed Map — inline within prosody section
   ─────────────────────────────────────────────────────────────────────────── */
.word-speed-inline {
  margin-top: 12px;
  padding-top: 10px;
  border-top: 1px solid #eee;
}

.word-speed-header {
  display: flex;
  align-items: center;
  gap: 12px;
  margin-bottom: 6px;
}

.word-speed-label {
  font-size: 0.85rem;
  font-weight: 600;
  color: #555;
  margin: 0;
}

.ws-pause-toggle {
  font-size: 0.78rem;
  color: #777;
  cursor: pointer;
  user-select: none;
  display: flex;
  align-items: center;
  gap: 4px;
}

.ws-pause-toggle input[type="checkbox"] {
  margin: 0;
  cursor: pointer;
}

.word-speed-note {
  font-size: 0.75rem;
  color: #888;
  margin-bottom: 0.4rem;
  font-style: italic;
}

/* Legend */
.word-speed-legend {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
  font-size: 0.8rem;
}

.word-speed-legend span {
  padding: 2px 6px;
  border-radius: 3px;
}

/* Word line height for passage readability */
.word-speed-words { line-height: 2; }

/* Tier colors — names describe observable behavior, not cognitive states */
.ws-quick       { background: #c8e6c9; color: #1b5e20; border-radius: 2px; padding: 1px 2px; }
.ws-steady      { background: #e8f5e9; color: #2e7d32; border-radius: 2px; padding: 1px 2px; }
.ws-slow        { background: #fff9c4; color: #f57f17; border-radius: 2px; padding: 1px 2px; }
.ws-struggling  { background: #ffe0b2; color: #e65100; border-radius: 2px; padding: 1px 2px; }
.ws-stalled     { background: #ffcdd2; color: #b71c1c; border-radius: 2px; padding: 1px 2px; }
.ws-omitted     { background: #e0e0e0; color: #9e9e9e; border-radius: 2px; padding: 1px 2px;
                  text-decoration: line-through; }
.ws-no-data     { background: #f5f5f5; color: #bdbdbd; border-radius: 2px; padding: 1px 2px; }

/* Outlier highlight toggle */
.metric-box-active { outline: 2px solid #1976d2; outline-offset: -2px; background: #e3f2fd !important; }
.show-outliers .word-speed-words [data-outlier="true"] {
  outline: 2px solid #1976d2;
  outline-offset: 1px;
  border-radius: 3px;
}

/* Summary bar */
.word-speed-summary {
  margin-top: 8px;
  padding: 8px;
  background: #fff;
  border: 1px solid #eee;
  border-radius: 4px;
  font-size: 0.85em;
}

.ws-dist-bar {
  height: 8px;
  display: flex;
  border-radius: 4px;
  overflow: hidden;
  margin: 4px 0;
}

.ws-dist-bar .seg-quick       { background: #4caf50; }
.ws-dist-bar .seg-steady      { background: #8bc34a; }
.ws-dist-bar .seg-slow        { background: #ffc107; }
.ws-dist-bar .seg-struggling  { background: #ff9800; }
.ws-dist-bar .seg-stalled     { background: #f44336; }

/* ───────────────────────────────────────────────────────────────────────────
   Custom tooltip (replaces native title for word elements — mobile-friendly)
   ─────────────────────────────────────────────────────────────────────────── */
.word-tooltip {
  position: absolute;
  z-index: 1000;
  background: #333;
  color: #fff;
  padding: 8px 12px;
  border-radius: 6px;
  font-size: 0.8rem;
  font-family: 'Consolas', monospace;
  white-space: pre-wrap;
  max-width: 360px;
  line-height: 1.4;
  pointer-events: auto;
  box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}
.word-tooltip .tooltip-play {
  display: inline-block;
  margin-top: 6px;
  padding: 2px 10px;
  background: #1976d2;
  color: #fff;
  border: none;
  border-radius: 3px;
  cursor: pointer;
  font-size: 0.8rem;
}
.word-tooltip .tooltip-play:active { background: #1565c0; }
.word-tooltip .tooltip-footer {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-top: 6px;
  padding-top: 5px;
  border-top: 1px solid rgba(255,255,255,0.15);
}
.word-tooltip .tooltip-footer .tooltip-play { margin-top: 0; }
.word-tooltip .tooltip-nl {
  font-size: 0.75rem;
  color: #b0bec5;
  white-space: nowrap;
}
.word-active-tooltip { outline: 2px solid #1976d2; outline-offset: 1px; border-radius: 2px; }
.word-tooltip .tooltip-oov {
  background: #fff3e0;
  color: #e65100;
  border-radius: 4px;
  padding: 2px 6px;
  margin-top: 4px;
  font-size: 0.85em;
  font-weight: 600;
}

/* ───────────────────────────────────────────────────────────────────────────
   Model Disagreement Word Map — shows cross-validation status at a glance
   ─────────────────────────────────────────────────────────────────────────── */
.stt-disagreement-row {
  margin-bottom: 0.75rem;
  padding-bottom: 0.5rem;
  border-bottom: 1px solid #e0e0e0;
}

.disagree-word {
  display: inline-block;
  margin: 2px;
  padding: 2px 6px;
  border-radius: 3px;
  font-size: 0.9rem;
  cursor: pointer;
}

.disagree-agreed {
  color: #999;
  opacity: 0.3;
  cursor: default;
}

.disagree-disagreed {
  background: #fff3e0;
  color: #e65100;
  border: 1px solid #ffcc80;
}

.disagree-unconfirmed {
  background: #e3f2fd;
  color: #1565c0;
  border: 1px solid #90caf9;
}

.disagree-recovered {
  background: #fce4ec;
  color: #c62828;
  border: 1px solid #ef9a9a;
}

.disagree-disfluency {
  background: #fffde7;
  color: #f57f17;
  border: 1px solid #fff176;
}

.disagree-unconsumed {
  background: #f3e5f5;
  color: #7b1fa2;
  border: 1px solid #ce93d8;
}

/* Recovered word warning badge — (!) indicator in main analyzed word map */
.word-recovered-badge {
  position: relative;
}

.word-recovered-badge::after {
  content: '⚠';
  position: absolute;
  top: 50%;
  right: -7px;
  transform: translateY(-50%);
  font-size: 0.6rem;
  font-weight: 700;
  color: #c62828;
  line-height: 1;
  pointer-events: none;
  background: #fff;
  border-radius: 50%;
  padding: 1px 2px;
  z-index: 1;
}

/* Disagreement map legend */
.disagree-legend {
  display: flex;
  flex-wrap: wrap;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
  font-size: 0.75rem;
}

.disagree-legend span {
  padding: 1px 6px;
  border-radius: 3px;
}

/* Insertion highlight overlay */
.word-highlight-insertion {
  box-shadow: 0 0 0 3px rgba(21, 101, 192, 0.4);
  outline: 2px solid #1565c0;
  outline-offset: 2px;
}

.word[data-start-time] {
  transition: box-shadow 0.2s ease, outline 0.2s ease;
}

/* ── New Analyzed Words — Bucket Classification ────────────────────────── */
.new-analyzed-player { margin-bottom: 0.75rem; }
.new-analyzed-player audio { width: 100%; max-width: 400px; height: 36px; }

.new-analyzed-legend {
  background: #f8f8f8;
  border: 1px solid #e0e0e0;
  border-radius: 6px;
  padding: 0.6rem 0.75rem;
  margin-bottom: 1rem;
}
.legend-row { display: flex; flex-wrap: wrap; align-items: center; gap: 4px; }
.legend-row + .legend-row { margin-top: 0.4rem; padding-top: 0.4rem; border-top: 1px solid #eee; }
.legend-label { font-size: 0.7rem; font-weight: 700; color: #888; text-transform: uppercase; letter-spacing: 0.5px; min-width: 68px; flex-shrink: 0; }
.new-analyzed-legend .word { font-size: 0.75rem; margin: 0; padding: 2px 6px; }
.new-analyzed-legend .pause-indicator { font-size: 0.75rem; }
.new-analyzed-legend .word-fragment { font-size: 0.7rem; }

.new-analyzed-flow {
  line-height: 2.8;
  padding: 0.5rem 0.25rem;
  word-spacing: 6px;
}
.new-analyzed-flow .word { padding: 4px 8px; margin: 3px 3px; font-size: 0.95rem; }

.word-bucket-correct { background: #c8e6c9; color: #2e7d32; }
.word-bucket-struggle-correct { background: #dcedc8; color: #558b2f; border-bottom: 2px solid #8bc34a; }
.word-bucket-omitted { background: #e0e0e0; color: #757575; text-decoration: line-through; }
.word-bucket-attempted-struggled { background: #ffe0b2; color: #e65100; }
.word-bucket-definite-struggle { background: #ffcdd2; color: #c62828; }
.word-bucket-confirmed-substitution { background: #bbdefb; color: #1565c0; }
.word-bucket-confirmed-insertion { background: #e1bee7; color: #6a1b9a; font-weight: 600; }
.word-bucket-pk-trust-forgiven { background: #e8f5e9; color: #4caf50; }

/* Morphological root squiggle — V1 or V0 produced a root of the ref word */
.word-morph-root { text-decoration: underline wavy #e65100; text-underline-offset: 3px; }

/* Word group: wraps fragments + their associated word so they stay visually together */
.word-group {
  display: inline-flex;
  align-items: baseline;
  gap: 0;
}
.word-group .word { margin: 0; padding-left: 2px; }

/* Insertion fragment spans (small purple text for false starts / trailing fragments) */
.word-fragment {
  font-size: 0.7rem;
  color: #7b1fa2;
  font-style: italic;
  vertical-align: super;
  margin: 0 0 0 1px;
  padding: 1px 3px;
  background: #f3e5f5;
  border-radius: 3px;
  cursor: pointer;
}
.word-fragment-after {
  margin: 0 1px 0 0;
}

